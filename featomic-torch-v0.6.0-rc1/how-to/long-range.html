<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Reference guides" href="../references/index.html" /><link rel="prev" title="Splined radial integral" href="splined-radial-integral.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>Long-range only LODE descriptor - Featomic 0.6.0-rc2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/featomic.css?v=191cc0c0" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Featomic 0.6.0-rc2 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Featomic 0.6.0-rc2 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../get-started/index.html">Getting started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../get-started/featomic.html">What is featomic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get-started/installation.html">Installation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../get-started/tutorials.html">Tutorials: using featomic from Python</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Tutorials: using featomic from Python</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/first-calculation.html">First descriptor computation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">How-to guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of How-to guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="computing-soap.html">Computing SOAP features</a></li>
<li class="toctree-l2"><a class="reference internal" href="sample-selection.html">Sample Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="property-selection.html">Property Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="keys-selection.html">Keys selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="splined-radial-integral.html">Splined radial integral</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Long-range only LODE descriptor</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../references/index.html">Reference guides</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Reference guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../references/calculators/index.html">Calculator reference</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Calculator reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/spherical-expansion.html">Spherical expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/spherical-expansion-by-pair.html">Spherical expansion by pair</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/lode-spherical-expansion.html">LODE spherical expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/soap-radial-spectrum.html">SOAP radial spectrum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/soap-power-spectrum.html">SOAP power spectrum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/atomic-composition.html">Atomic Composition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/neighbor-list.html">Neighbor List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../references/calculators/sorted-distances.html">Sorted distance vector</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../references/api/index.html">API documentation</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of API documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../references/api/python/index.html">Python</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Python</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/systems.html">Available system implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/calculators.html">Available Calculators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/misc.html">Miscellaneous</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/cutoff.html">Local environments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/density.html">Atomic density</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/basis.html">Basis functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/splines.html">Splined radial integrals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/python/clebsch-gordan.html">Clebsch-Gordan products</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../references/api/torch/index.html">TorchScript</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of TorchScript</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../references/api/torch/systems.html">System</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/torch/calculators.html">Calculators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/torch/clebsch-gordan.html">Clebsch-Gordan products</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../references/api/torch/cxx/index.html">TorchScript C++ API reference</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of TorchScript C++ API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../references/api/torch/cxx/calculators.html">Calculators</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../references/api/rust.html">Rust</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../references/api/c/index.html">C</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of C</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../references/api/c/systems.html">Defining systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/c/calculators.html">Dealing with calculators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/c/misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../references/api/cxx/index.html">C++</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of C++</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../references/api/cxx/systems.html">Defining systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/cxx/calculators.html">Dealing with calculators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../references/api/cxx/misc.html">Miscellaneous</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../explanations/index.html">Explanations</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Explanations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanations/concepts.html">Core concepts of featomic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/soap.html">What is SOAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/rotation_adapted.html">Rotation-Adapted Features</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../devdoc/index.html">Developer documentation</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of Developer documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../devdoc/get-started.html">Getting started</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../devdoc/how-to/index.html">How-to guides</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of How-to guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/how-to/new-calculator.html">Adding a new calculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/how-to/profiling.html">Profiling calculation</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../devdoc/explanations/index.html">Explanations</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of Explanations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/explanations/architecture.html">Code organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/explanations/interfaces.html">Python and C interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/explanations/radial-integral.html">SOAP and LODE radial integrals</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/how-to/long-range.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="long-range-only-lode-descriptor">
<span id="userdoc-how-to-long-range-descriptor"></span><h1>Long-range only LODE descriptor<a class="headerlink" href="#long-range-only-lode-descriptor" title="Link to this heading">¶</a></h1>
<p>The <a class="reference internal" href="../references/api/python/calculators.html#featomic.LodeSphericalExpansion" title="featomic.LodeSphericalExpansion"><code class="xref py py-class docutils literal notranslate"><span class="pre">LodeSphericalExpansion</span></code></a> allows
the calculation of a descriptor that includes all atoms within the system and
projects them onto a spherical expansion/ fingerprint within a given <code class="docutils literal notranslate"><span class="pre">cutoff</span></code>.
This is very useful if long-range interactions between atoms are important to
describe the physics and chemistry of a collection of atoms. However, as stated
the descriptor contains <strong>ALL</strong> atoms of the system and sometimes it can be
desired to only have a long-range/exterior only descriptor that only includes
the atoms outside a given cutoff. Sometimes there descriptors are also denoted
by far-field descriptors.</p>
<p>A long range only descriptor can be particular useful when one already has a
good descriptor for the short-range density like (SOAP) and the long-range
descriptor (far field) should contain different information from what the
short-range descriptor already offers.</p>
<p>Such descriptor can be constructed within <cite>featomic</cite> as sketched by the image
below.</p>
<figure class="align-center">
<img alt="../_images/long-range-descriptor.svg" src="../_images/long-range-descriptor.svg" /></figure>
<p>In this example will construct such a descriptor using the <a class="reference internal" href="../references/api/python/splines.html#python-utils-splines"><span class="std std-ref">radial integral
splining</span></a> tools of <cite>featomic</cite>.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button></div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="sphx-glr-footer sphx-glr-footer-example docutils container">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/36d886e596f0b08a8c0e4ccbd309a891/long-range-descriptor.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code</span> <span class="pre">for</span> <span class="pre">this</span> <span class="pre">example:</span> <span class="pre">long-range-descriptor.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/52d185a9d75bdcffe38b2bef27c7b982/long-range-descriptor.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook</span> <span class="pre">for</span> <span class="pre">this</span> <span class="pre">example:</span> <span class="pre">long-range-descriptor.ipynb</span></code></a></p>
</div>
</div>
<p>We start the example by loading the required packages</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ase</span>
<span class="kn">import</span> <span class="nn">ase.visualize.plot</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">molecule</span>
<span class="kn">from</span> <span class="nn">metatensor</span> <span class="kn">import</span> <span class="n">LabelsEntry</span><span class="p">,</span> <span class="n">TensorMap</span>

<span class="kn">import</span> <span class="nn">featomic</span>
<span class="kn">from</span> <span class="nn">featomic</span> <span class="kn">import</span> <span class="n">LodeSphericalExpansion</span><span class="p">,</span> <span class="n">SphericalExpansion</span>
</pre></div>
</div>
<p><strong>Single water molecule (short range) system</strong></p>
<p>Our first test system is a single water molecule with a <span class="math notranslate nohighlight">\(15\,\mathrm{Å}\)</span>
vacuum layer around it.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">atoms</span> <span class="o">=</span> <span class="n">molecule</span><span class="p">(</span><span class="s2">&quot;H2O&quot;</span><span class="p">,</span> <span class="n">vacuum</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>We choose a <code class="docutils literal notranslate"><span class="pre">cutoff</span></code> for the projection of the spherical expansion and the
neighbor search of the real space spherical expansion.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">cutoff</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>We can use ase’s visualization tools to plot the system and draw a gray circle to
indicate the <code class="docutils literal notranslate"><span class="pre">cutoff</span></code> radius.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ase</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>

<span class="n">cutoff_circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
    <span class="n">xy</span><span class="o">=</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">radius</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
    <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">cutoff_circle</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Å&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Å&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_long-range-descriptor_001.png" srcset="../_images/sphx_glr_long-range-descriptor_001.png" alt="long range descriptor" class = "sphx-glr-single-img"/><p>As you can see, for a single water molecule, the <code class="docutils literal notranslate"><span class="pre">cutoff</span></code> includes all atoms of
the system. The combination of the test system and the <code class="docutils literal notranslate"><span class="pre">cutoff</span></code> aims to
demonstrate that the full atomic fingerprint is contained within the <code class="docutils literal notranslate"><span class="pre">cutoff</span></code>.
By later subtracting the short-range density from the LODE density, we will observe
that the difference between them is almost zero, indicating that a single water
molecule is a short-range system.</p>
<p>For the density, we choose a smeared power law as used in LODE, which does not decay
exponentially like a <a class="reference internal" href="../references/api/python/density.html#featomic.density.Gaussian" title="featomic.density.Gaussian"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gaussian</span></code></a> density and is
therefore suited to describe long-range interactions between atoms.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">density</span> <span class="o">=</span> <span class="n">featomic</span><span class="o">.</span><span class="n">density</span><span class="o">.</span><span class="n">SmearedPowerLaw</span><span class="p">(</span><span class="n">smearing</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">exponent</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>To visualize this we plot <code class="docutils literal notranslate"><span class="pre">density</span></code> together with a Gaussian density
(<code class="docutils literal notranslate"><span class="pre">gaussian_density</span></code>) with the same <code class="docutils literal notranslate"><span class="pre">width</span></code> in a log-log plot.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">radial_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">gaussian_density</span> <span class="o">=</span> <span class="n">featomic</span><span class="o">.</span><span class="n">density</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">density</span><span class="o">.</span><span class="n">smearing</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">radial_positions</span><span class="p">,</span>
    <span class="n">density</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">radial_positions</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SmearedPowerLaw&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">radial_positions</span><span class="p">,</span>
    <span class="n">gaussian_density</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">radial_positions</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">positions_indicator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">positions_indicator</span><span class="p">,</span>
    <span class="mi">2</span> <span class="o">*</span> <span class="n">positions_indicator</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">density</span><span class="o">.</span><span class="n">exponent</span><span class="p">),</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;exponent=</span><span class="si">{</span><span class="n">density</span><span class="o">.</span><span class="n">exponent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1e-1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">5e-1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;radial positions / Å&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;atomic density&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_long-range-descriptor_002.png" srcset="../_images/sphx_glr_long-range-descriptor_002.png" alt="long range descriptor" class = "sphx-glr-single-img"/><p>We see that the <code class="docutils literal notranslate"><span class="pre">SmearedPowerLaw</span></code> decays with a power law of 3, which is the
potential exponent we picked above, wile the <a class="reference internal" href="../references/api/python/density.html#featomic.density.Gaussian" title="featomic.density.Gaussian"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gaussian</span></code></a> density decays exponentially and is therefore not suited
for long-range descriptors.</p>
<p>As a projection basis, we don’t use the usual <a class="reference internal" href="../references/api/python/basis.html#featomic.basis.Gto" title="featomic.basis.Gto"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gto</span></code></a>
which is commonly used for short range descriptors. Instead, we select the
<a class="reference internal" href="../references/api/python/basis.html#featomic.basis.Monomials" title="featomic.basis.Monomials"><code class="xref py py-class docutils literal notranslate"><span class="pre">Monomials</span></code></a> which is the optimal radial basis
for the LODE descriptor as discussed in <a class="reference external" href="https://doi.org/10.1021/acs.jpclett.3c02375">Huguenin-Dumittan et al.</a></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">by_angular</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">angular</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">by_angular</span><span class="p">[</span><span class="n">angular</span><span class="p">]</span> <span class="o">=</span> <span class="n">featomic</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">Monomials</span><span class="p">(</span>
        <span class="n">radius</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">angular_channel</span><span class="o">=</span><span class="n">angular</span><span class="p">,</span> <span class="n">max_radial</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">)</span>


<span class="n">basis</span> <span class="o">=</span> <span class="n">featomic</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">Explicit</span><span class="p">(</span>
    <span class="n">by_angular</span><span class="o">=</span><span class="n">by_angular</span><span class="p">,</span>
    <span class="c1"># We choose a relatively low spline accuracy (default is ``1e-8``) to achieve quick</span>
    <span class="c1"># computation of the spline points. You can increase the spline accuracy if</span>
    <span class="c1"># required, but be aware that the time to compute these points will increase</span>
    <span class="c1"># significantly!</span>
    <span class="n">spline_accuracy</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We now have all building blocks to construct the spline for the real and
Fourier space spherical expansions.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">real_space_spliner</span> <span class="o">=</span> <span class="n">featomic</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">SoapSpliner</span><span class="p">(</span>
    <span class="c1"># We don&#39;t use a ``smoothing`` function in the cutoff or a ``radial_scaling`` in the</span>
    <span class="c1"># density to ensure the correct construction of the long-range only descriptor</span>
    <span class="n">cutoff</span><span class="o">=</span><span class="n">featomic</span><span class="o">.</span><span class="n">cutoff</span><span class="o">.</span><span class="n">Cutoff</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">basis</span><span class="o">=</span><span class="n">basis</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">real_space_hypers</span> <span class="o">=</span> <span class="n">real_space_spliner</span><span class="o">.</span><span class="n">get_hypers</span><span class="p">()</span>

<span class="n">fourier_space_spliner</span> <span class="o">=</span> <span class="n">featomic</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">LodeSpliner</span><span class="p">(</span>
    <span class="n">basis</span><span class="o">=</span><span class="n">basis</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fourier_space_hypers</span> <span class="o">=</span> <span class="n">fourier_space_spliner</span><span class="o">.</span><span class="n">get_hypers</span><span class="p">()</span>
</pre></div>
</div>
<p>With the splines ready, we now compute the two spherical expansions</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">real_space_calculator</span> <span class="o">=</span> <span class="n">SphericalExpansion</span><span class="p">(</span><span class="o">**</span><span class="n">real_space_hypers</span><span class="p">)</span>
<span class="n">real_space_expansion</span> <span class="o">=</span> <span class="n">real_space_calculator</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>


<span class="n">fourier_space_calculator</span> <span class="o">=</span> <span class="n">LodeSphericalExpansion</span><span class="p">(</span><span class="o">**</span><span class="n">fourier_space_hypers</span><span class="p">)</span>
<span class="n">fourier_space_expansion</span> <span class="o">=</span> <span class="n">fourier_space_calculator</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
</pre></div>
</div>
<p>As described in the beginning, we now subtract the real space LODE contributions
from Fourier space to obtain a descriptor that only contains the contributions from
atoms outside of the <code class="docutils literal notranslate"><span class="pre">cutoff</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">delta_expansion</span> <span class="o">=</span> <span class="n">fourier_space_expansion</span> <span class="o">-</span> <span class="n">real_space_expansion</span>
</pre></div>
</div>
<p>You can now use the <code class="docutils literal notranslate"><span class="pre">delta_expansion</span></code> as a purely long-range descriptor in
combination with a short-range descriptor like
<a class="reference internal" href="../references/api/python/calculators.html#featomic.SphericalExpansion" title="featomic.SphericalExpansion"><code class="xref py py-class docutils literal notranslate"><span class="pre">featomic.SphericalExpansion</span></code></a> for your machine learning models.</p>
<p>We now verify that for our test <code class="docutils literal notranslate"><span class="pre">atoms</span></code> the LODE spherical expansion only contains
short-range contributions. To demonstrate this, we densify the
<a class="reference external" href="https://docs.metatensor.org/latest/core/reference/python/tensor.html#metatensor.TensorMap" title="(in metatensor)"><code class="xref py py-class docutils literal notranslate"><span class="pre">metatensor.TensorMap</span></code></a> to have only one block per <code class="docutils literal notranslate"><span class="pre">&quot;center_type&quot;</span></code> and
visualize our result. Since we have to perform the densify operation several times in
this how-to, we define a helper function <code class="docutils literal notranslate"><span class="pre">densify_tensormap</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">densify_tensormap</span><span class="p">(</span><span class="n">tensor</span><span class="p">:</span> <span class="n">TensorMap</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TensorMap</span><span class="p">:</span>
    <span class="n">dense_tensor</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">components_to_properties</span><span class="p">(</span><span class="s2">&quot;o3_mu&quot;</span><span class="p">)</span>
    <span class="n">dense_tensor</span> <span class="o">=</span> <span class="n">dense_tensor</span><span class="o">.</span><span class="n">keys_to_samples</span><span class="p">(</span><span class="s2">&quot;neighbor_type&quot;</span><span class="p">)</span>
    <span class="n">dense_tensor</span> <span class="o">=</span> <span class="n">dense_tensor</span><span class="o">.</span><span class="n">keys_to_properties</span><span class="p">([</span><span class="s2">&quot;o3_lambda&quot;</span><span class="p">,</span> <span class="s2">&quot;o3_sigma&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">dense_tensor</span>
</pre></div>
</div>
<p>We apply the function to the Fourier space spherical expansion
<code class="docutils literal notranslate"><span class="pre">fourier_space_expansion</span></code> and <code class="docutils literal notranslate"><span class="pre">subtracted_expansion</span></code>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fourier_space_expansion</span> <span class="o">=</span> <span class="n">densify_tensormap</span><span class="p">(</span><span class="n">fourier_space_expansion</span><span class="p">)</span>
<span class="n">delta_expansion</span> <span class="o">=</span> <span class="n">densify_tensormap</span><span class="p">(</span><span class="n">delta_expansion</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we plot the values of each block for the Fourier Space spherical expansion
in the upper panel and the difference between the Fourier Space and the real space
in the lower panel. And since we will do this plot several times we again define a
small plot function to help us</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_value_comparison</span><span class="p">(</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">LabelsEntry</span><span class="p">,</span>
    <span class="n">fourier_space_expansion</span><span class="p">:</span> <span class="n">TensorMap</span><span class="p">,</span>
    <span class="n">subtracted_expansion</span><span class="p">:</span> <span class="n">TensorMap</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="n">values_subtracted</span> <span class="o">=</span> <span class="n">subtracted_expansion</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">values_fourier_space</span> <span class="o">=</span> <span class="n">fourier_space_expansion</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;center_type=</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Fourier space sph. expansion&quot;</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">values_fourier_space</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;sample index&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Difference between Fourier and real space sph. expansion&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">values_subtracted</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;sample index&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;property index&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;values&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We first plot the values of the TensorMaps for center_type=1 (hydrogen)</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_value_comparison</span><span class="p">(</span>
    <span class="n">fourier_space_expansion</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fourier_space_expansion</span><span class="p">,</span> <span class="n">delta_expansion</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_long-range-descriptor_003.png" srcset="../_images/sphx_glr_long-range-descriptor_003.png" alt="center_type=1  Fourier space sph. expansion, Difference between Fourier and real space sph. expansion" class = "sphx-glr-single-img"/><p>and for center_type=8 (oxygen)</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_value_comparison</span><span class="p">(</span>
    <span class="n">fourier_space_expansion</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fourier_space_expansion</span><span class="p">,</span> <span class="n">delta_expansion</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_long-range-descriptor_004.png" srcset="../_images/sphx_glr_long-range-descriptor_004.png" alt="center_type=8  Fourier space sph. expansion, Difference between Fourier and real space sph. expansion" class = "sphx-glr-single-img"/><p>The plot shows that the spherical expansion for the Fourier space is non-zero while
the difference between the two expansions is very small.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Small residual values may stems from the contribution of the periodic images. You
can verify and reduce those contributions by either increasing the cell and/or
increase the <code class="docutils literal notranslate"><span class="pre">potential_exponent</span></code>.</p>
</div>
<p><strong>Two water molecule (long range) system</strong></p>
<p>We now add a second water molecule shifted by <span class="math notranslate nohighlight">\(3\,\mathrm{Å}\)</span> in each
direction from our first water molecule to show that such a system has non
negligible long range effects.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">atoms_shifted</span> <span class="o">=</span> <span class="n">molecule</span><span class="p">(</span><span class="s2">&quot;H2O&quot;</span><span class="p">,</span> <span class="n">vacuum</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">atoms_shifted</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span> <span class="o">+</span> <span class="mi">3</span>

<span class="n">atoms_long_range</span> <span class="o">=</span> <span class="n">atoms</span> <span class="o">+</span> <span class="n">atoms_shifted</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ase</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot_atoms</span><span class="p">(</span><span class="n">atoms_long_range</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">cutoff_circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
    <span class="n">xy</span><span class="o">=</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
    <span class="n">radius</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
    <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">cutoff_circle_shifted</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
    <span class="n">xy</span><span class="o">=</span><span class="n">atoms_shifted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
    <span class="n">radius</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
    <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">cutoff_circle</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">cutoff_circle_shifted</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Å&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Å&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_long-range-descriptor_005.png" srcset="../_images/sphx_glr_long-range-descriptor_005.png" alt="long range descriptor" class = "sphx-glr-single-img"/><p>As you can see, the <code class="docutils literal notranslate"><span class="pre">cutoff</span></code> radii of the two molecules are completely disjoint.
Therefore, a short-range model will not able to describe the intermolecular
interactions between our two molecules. To verify we now again create a long-range
only descriptor for this system. We use the already defined
<code class="docutils literal notranslate"><span class="pre">real_space_expansion_long_range</span></code> and <code class="docutils literal notranslate"><span class="pre">fourier_space_expansion_long_range</span></code></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">real_space_expansion_long_range</span> <span class="o">=</span> <span class="n">real_space_calculator</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">atoms_long_range</span><span class="p">)</span>
<span class="n">fourier_space_expansion_long_range</span> <span class="o">=</span> <span class="n">fourier_space_calculator</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">atoms_long_range</span><span class="p">)</span>
</pre></div>
</div>
<p>We now first verify that the contribution from the short-range descriptors is the
same as for a single water molecule. Exemplarily, we compare only the first
(Hydrogen) block of each tensor.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Single water real space spherical expansion&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">real_space_expansion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Two water real space spherical expansion&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">real_space_expansion_long_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Single water real space spherical expansion
[[[-0.267 -0.101 -0.06  -0.044 -0.035]
  [ 0.     0.     0.     0.     0.   ]
  [ 0.     0.     0.     0.     0.   ]]

 [[ 0.267  0.101  0.06   0.044  0.035]
  [ 0.     0.     0.     0.     0.   ]
  [ 0.     0.     0.     0.     0.   ]]]

Two water real space spherical expansion
[[[-0.267 -0.101 -0.06  -0.044 -0.035]
  [ 0.     0.     0.     0.     0.   ]
  [ 0.     0.     0.     0.     0.   ]]

 [[ 0.267  0.101  0.06   0.044  0.035]
  [ 0.     0.     0.     0.     0.   ]
  [ 0.     0.     0.     0.     0.   ]]

 [[-0.267 -0.101 -0.06  -0.044 -0.035]
  [ 0.     0.     0.     0.     0.   ]
  [ 0.     0.     0.     0.     0.   ]]

 [[ 0.267  0.101  0.06   0.044  0.035]
  [ 0.     0.     0.     0.     0.   ]
  [ 0.     0.     0.     0.     0.   ]]]
</pre></div>
</div>
<p>Since the values of the block are the same, we can conclude that there is no
information shared between the two molecules and that the short-range descriptor is
not able to distinguish the system with only one or two water molecules. Note that
the different number of <cite>samples</cite> in <code class="docutils literal notranslate"><span class="pre">real_space_expansion_long_range</span></code> reflects
the fact that the second system has more atoms then the first.</p>
<p>As above, we construct a long-range only descriptor and densify the result for
plotting the values.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">delta_expansion_long_range</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">fourier_space_expansion_long_range</span> <span class="o">-</span> <span class="n">real_space_expansion_long_range</span>
<span class="p">)</span>

<span class="n">fourier_space_expansion_long_range</span> <span class="o">=</span> <span class="n">densify_tensormap</span><span class="p">(</span>
    <span class="n">fourier_space_expansion_long_range</span>
<span class="p">)</span>
<span class="n">delta_expansion_long_range</span> <span class="o">=</span> <span class="n">densify_tensormap</span><span class="p">(</span><span class="n">delta_expansion_long_range</span><span class="p">)</span>
</pre></div>
</div>
<p>As above, we plot the values of the spherical expansions for the Fourier and the
subtracted (long range only) spherical expansion. First for hydrogen
(<code class="docutils literal notranslate"><span class="pre">center_species=1</span></code>)</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_value_comparison</span><span class="p">(</span>
    <span class="n">fourier_space_expansion_long_range</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">fourier_space_expansion_long_range</span><span class="p">,</span>
    <span class="n">delta_expansion_long_range</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_long-range-descriptor_006.png" srcset="../_images/sphx_glr_long-range-descriptor_006.png" alt="center_type=1  Fourier space sph. expansion, Difference between Fourier and real space sph. expansion" class = "sphx-glr-single-img"/><p>amd second for oxygen (<code class="docutils literal notranslate"><span class="pre">center_species=8</span></code>)</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_value_comparison</span><span class="p">(</span>
    <span class="n">fourier_space_expansion_long_range</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">fourier_space_expansion_long_range</span><span class="p">,</span>
    <span class="n">delta_expansion_long_range</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_long-range-descriptor_007.png" srcset="../_images/sphx_glr_long-range-descriptor_007.png" alt="center_type=8  Fourier space sph. expansion, Difference between Fourier and real space sph. expansion" class = "sphx-glr-single-img"/><p>We clearly see that the values of the subtracted spherical are much larger compared
to the system with only a single water molecule, thus confirming the presence of
long-range contributions in the descriptor for a system with two water molecules.</p>
</div></div>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../references/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Reference guides</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="splined-radial-integral.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Splined radial integral</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Guillaume Fraux, Philip Loche, Sergei Kliavinek, Kevin Kazuki Huguenin-Dumittan, Davide Tisi, Alexander Goscinski
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link fa-brands fa-github fa-2x" href="https://github.com/metatensor/featomic" aria-label="GitHub"></a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=aaa0c780"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/tabs.js?v=3030b3cb"></script>
    </body>
</html>